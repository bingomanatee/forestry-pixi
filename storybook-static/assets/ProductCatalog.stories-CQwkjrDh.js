const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BitmapFont-CAPwMx0M.js","./BoxLeafStore-BrDG2RJT.js","./preload-helper-PPVm8Dsz.js"])))=>i.map(i=>d[i]);
import{D as A,a7 as E,x as g,a8 as x,a9 as ge,T as re,w,aa as k,ab as ie,k as y,ac as W,ad as ue,I as oe,ae as me,af as R,O as M,ag as H,A as Ae,G as X,B as O,ah as Z,ai as ye}from"./BoxLeafStore-BrDG2RJT.js";import{_ as ve}from"./preload-helper-PPVm8Dsz.js";const $={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const e=s.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const c in e){const l=e[c].match(/^[a-z]+/gm)[0],f=e[c].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const m in f){const v=f[m].split("="),b=v[0],T=v[1].replace(/"/gm,""),Y=parseFloat(T),fe=isNaN(Y)?T:Y;u[b]=fe}t[l].push(u)}const a={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=t.info,[r]=t.common,[i]=t.distanceField??[];i&&(a.distanceField={range:parseInt(i.distanceRange,10),type:i.fieldType}),a.fontSize=parseInt(n.size,10),a.fontFamily=n.face,a.lineHeight=parseInt(r.lineHeight,10);const o=t.page;for(let c=0;c<o.length;c++)a.pages.push({id:parseInt(o[c].id,10)||0,file:o[c].file});const d={};a.baseLineOffset=a.lineHeight-parseInt(r.base,10);const p=t.char;for(let c=0;c<p.length;c++){const l=p[c],f=parseInt(l.id,10);let u=l.letter??l.char??String.fromCharCode(f);u==="space"&&(u=" "),d[f]=u,a.chars[u]={id:f,page:parseInt(l.page,10)||0,x:parseInt(l.x,10),y:parseInt(l.y,10),width:parseInt(l.width,10),height:parseInt(l.height,10),xOffset:parseInt(l.xoffset,10),yOffset:parseInt(l.yoffset,10),xAdvance:parseInt(l.xadvance,10),kerning:{}}}const h=t.kerning||[];for(let c=0;c<h.length;c++){const l=parseInt(h[c].first,10),f=parseInt(h[c].second,10),u=parseInt(h[c].amount,10);a.chars[d[f]].kerning[d[l]]=u}return a}},J={test(s){const e=s;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},t=s.getElementsByTagName("info")[0],a=s.getElementsByTagName("common")[0],n=s.getElementsByTagName("distanceField")[0];n&&(e.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const r=s.getElementsByTagName("page"),i=s.getElementsByTagName("char"),o=s.getElementsByTagName("kerning");e.fontSize=parseInt(t.getAttribute("size"),10),e.fontFamily=t.getAttribute("face"),e.lineHeight=parseInt(a.getAttribute("lineHeight"),10);for(let p=0;p<r.length;p++)e.pages.push({id:parseInt(r[p].getAttribute("id"),10)||0,file:r[p].getAttribute("file")});const d={};e.baseLineOffset=e.lineHeight-parseInt(a.getAttribute("base"),10);for(let p=0;p<i.length;p++){const h=i[p],c=parseInt(h.getAttribute("id"),10);let l=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(c);l==="space"&&(l=" "),d[c]=l,e.chars[l]={id:c,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let p=0;p<o.length;p++){const h=parseInt(o[p].getAttribute("first"),10),c=parseInt(o[p].getAttribute("second"),10),l=parseInt(o[p].getAttribute("amount"),10);e.chars[d[c]].kerning[d[h]]=l}return e}},q={test(s){return typeof s=="string"&&s.match(/<font(\s|>)/)?J.test(A.get().parseXML(s)):!1},parse(s){return J.parse(A.get().parseXML(s))}},we=[".xml",".fnt"],xe={extension:{type:g.CacheParser,name:"cacheBitmapFont"},test:s=>!!s?.pages&&!!s?.chars&&typeof s?.fontFamily=="string",getCacheableAssets(s,e){const t={};return s.forEach(a=>{t[a]=e,t[`${a}-bitmap`]=e}),t[`${e.fontFamily}-bitmap`]=e,t}},be={extension:{type:g.LoadParser,priority:E.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return we.includes(x.extname(s).toLowerCase())},async testParse(s){return $.test(s)||q.test(s)},async parse(s,e,t){const a=$.test(s)?$.parse(s):q.parse(s),{src:n}=e,{pages:r}=a,i=[],o=a.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let l=0;l<r.length;++l){const f=r[l].file;let u=x.join(x.dirname(n),f);u=ge(u,n),i.push({src:u,data:o})}const[d,{BitmapFont:p}]=await Promise.all([t.load(i),ve(()=>import("./BitmapFont-CAPwMx0M.js"),__vite__mapDeps([0,1,2]),import.meta.url)]),h=i.map(l=>d[l.src]);return new p({data:a,textures:h},n)},async load(s,e){return await(await A.get().fetch(s)).text()},async unload(s,e,t){await Promise.all(s.pages.map(a=>t.unload(a.texture.source._sourceOrigin))),s.destroy()}};class _e{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let a=0;a<t;a++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const Be={extension:{type:g.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(e=>e instanceof re),getCacheableAssets:(s,e)=>{const t={};return s.forEach(a=>{e.forEach((n,r)=>{t[a+(r===0?"":r+1)]=n})}),t}};async function ce(s){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(s)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Ee={extension:{type:g.DetectionParser,priority:1},test:async()=>ce("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(e=>e!=="avif")},ee=["png","jpg","jpeg"],Ce={extension:{type:g.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...ee],remove:async s=>s.filter(e=>!ee.includes(e))},Ie="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function D(s){return Ie?!1:document.createElement("video").canPlayType(s)!==""}const Le={extension:{type:g.DetectionParser,priority:0},test:async()=>D("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(e=>e!=="mp4"&&e!=="m4v")},Pe={extension:{type:g.DetectionParser,priority:0},test:async()=>D("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(e=>e!=="ogv")},ke={extension:{type:g.DetectionParser,priority:0},test:async()=>D("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(e=>e!=="webm")},Me={extension:{type:g.DetectionParser,priority:0},test:async()=>ce("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(e=>e!=="webp")},le=class S{constructor(){this.loadOptions={...S.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,a)=>(this._parsersValidated=!1,e[t]=a,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const a={promise:null,parser:null};return a.promise=(async()=>{let n=null,r=null;if((t.parser||t.loadParser)&&(r=this._parserHash[t.parser||t.loadParser],t.loadParser&&w(`[Assets] "loadParser" is deprecated, use "parser" instead for ${e}`),r||w(`[Assets] specified load parser "${t.parser||t.loadParser}" not found while loading ${e}`)),!r){for(let i=0;i<this.parsers.length;i++){const o=this.parsers[i];if(o.load&&o.test?.(e,t,this)){r=o;break}}if(!r)return w(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await r.load(e,t,this),a.parser=r;for(let i=0;i<this.parsers.length;i++){const o=this.parsers[i];o.parse&&o.parse&&await o.testParse?.(n,t,this)&&(n=await o.parse(n,t,this)||n,a.parser=o)}return n})(),a}async load(e,t){this._parsersValidated||this._validateParsers();const a=typeof t=="function"?{...S.defaultOptions,...this.loadOptions,onProgress:t}:{...S.defaultOptions,...this.loadOptions,...t||{}},{onProgress:n,onError:r,strategy:i,retryCount:o,retryDelay:d}=a;let p=0;const h={},c=ie(e),l=k(e,m=>({alias:[m],src:m,data:{}})),f=l.reduce((m,v)=>m+(v.progressSize||1),0),u=l.map(async m=>{const v=x.toAbsolute(m.src);h[m.src]||(await this._loadAssetWithRetry(v,m,{onProgress:n,onError:r,strategy:i,retryCount:o,retryDelay:d},h),p+=m.progressSize||1,n&&n(p/f))});return await Promise.all(u),c?h[l[0].src]:h}async unload(e){const a=k(e,n=>({alias:[n],src:n})).map(async n=>{const r=x.toAbsolute(n.src),i=this.promiseCache[r];if(i){const o=await i.promise;delete this.promiseCache[r],await i.parser?.unload?.(o,n,this)}});await Promise.all(a)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name||e.id).reduce((e,t)=>(!t.name&&!t.id?w("[Assets] parser should have an id"):(e[t.name]||e[t.id])&&w(`[Assets] parser id conflict "${t.id}"`),e[t.name]=t,t.id&&(e[t.id]=t),e),{})}async _loadAssetWithRetry(e,t,a,n){let r=0;const{onError:i,strategy:o,retryCount:d,retryDelay:p}=a,h=c=>new Promise(l=>setTimeout(l,c));for(;;)try{this.promiseCache[e]||(this.promiseCache[e]=this._getLoadPromiseAndParser(e,t)),n[t.src]=await this.promiseCache[e].promise;return}catch(c){delete this.promiseCache[e],delete n[t.src],r++;const l=o!=="retry"||r>d;if(o==="retry"&&!l){i&&i(c,t),await h(p);continue}if(o==="skip"){i&&i(c,t);return}i&&i(c,t);const f=new Error(`[Loader.load] Failed to load ${e}.
${c}`);throw c instanceof Error&&c.stack&&(f.stack=c.stack),f}}};le.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let ze=le;function C(s,e){if(Array.isArray(e)){for(const t of e)if(s.startsWith(`data:${t}`))return!0;return!1}return s.startsWith(`data:${e}`)}function I(s,e){const t=s.split("?")[0],a=x.extname(t).toLowerCase();return Array.isArray(e)?e.includes(a):a===e}const Te=".json",Oe="application/json",Fe={extension:{type:g.LoadParser,priority:E.Low},name:"loadJson",id:"json",test(s){return C(s,Oe)||I(s,Te)},async load(s){return await(await A.get().fetch(s)).json()}},Re=".txt",Se="text/plain",We={name:"loadTxt",id:"text",extension:{type:g.LoadParser,priority:E.Low,name:"loadTxt"},test(s){return C(s,Se)||I(s,Re)},async load(s){return await(await A.get().fetch(s)).text()}},De=["normal","bold","100","200","300","400","500","600","700","800","900"],$e=[".ttf",".otf",".woff",".woff2"],je=["font/ttf","font/otf","font/woff","font/woff2"],Ue=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Ve(s){const e=x.extname(s),n=x.basename(s,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let r=n.length>0;for(const o of n)if(!o.match(Ue)){r=!1;break}let i=n.join(" ");return r||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}const Ge=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function He(s){return Ge.test(s)?s:encodeURI(s)}const Ne={extension:{type:g.LoadParser,priority:E.Low},name:"loadWebFont",id:"web-font",test(s){return C(s,je)||I(s,$e)},async load(s,e){const t=A.get().getFontFaceSet();if(t){const a=[],n=e.data?.family??Ve(s),r=e.data?.weights?.filter(o=>De.includes(o))??["normal"],i=e.data??{};for(let o=0;o<r.length;o++){const d=r[o],p=new FontFace(n,`url(${He(s)})`,{...i,weight:d});await p.load(),t.add(p),a.push(p)}return y.has(`${n}-and-url`)?y.get(`${n}-and-url`).entries.push({url:s,faces:a}):y.set(`${n}-and-url`,{entries:[{url:s,faces:a}]}),a.length===1?a[0]:a}return w("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const e=Array.isArray(s)?s:[s],t=e[0].family,a=y.get(`${t}-and-url`),n=a.entries.find(r=>r.faces.some(i=>e.indexOf(i)!==-1));n.faces=n.faces.filter(r=>e.indexOf(r)===-1),n.faces.length===0&&(a.entries=a.entries.filter(r=>r!==n)),e.forEach(r=>{A.get().getFontFaceSet().delete(r)}),a.entries.length===0&&y.remove(`${t}-and-url`)}};function K(s,e=1){const t=W.RETINA_PREFIX?.exec(s);return t?parseFloat(t[1]):e}function Q(s,e,t){s.label=t,s._sourceOrigin=t;const a=new re({source:s,label:t}),n=()=>{delete e.promiseCache[t],y.has(t)&&y.remove(t)};return a.source.once("destroy",()=>{e.promiseCache[t]&&(w("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),a.once("destroy",()=>{s.destroyed||(w("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),a}const Xe=".svg",Ke="image/svg+xml",Qe={extension:{type:g.LoadParser,priority:E.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return C(s,Ke)||I(s,Xe)},async load(s,e,t){return e.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?Ze(s):Ye(s,e,t,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function Ye(s,e,t,a){const n=await A.get().fetch(s),r=A.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,r.crossOrigin=a,await r.decode();const i=e.data?.width??r.width,o=e.data?.height??r.height,d=e.data?.resolution||K(s),p=Math.ceil(i*d),h=Math.ceil(o*d),c=A.get().createCanvas(p,h),l=c.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(r,0,0,i*d,o*d);const{parseAsGraphicsContext:f,...u}=e.data??{},m=new oe({resource:c,alphaMode:"premultiply-alpha-on-upload",resolution:d,...u});return Q(m,t,s)}async function Ze(s){const t=await(await A.get().fetch(s)).text(),a=new ue;return a.svg(t),a}const Je=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function") return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let _=null,N=class{constructor(){_||(_=URL.createObjectURL(new Blob([Je],{type:"application/javascript"}))),this.worker=new Worker(_)}};N.revokeObjectURL=function(){_&&(URL.revokeObjectURL(_),_=null)};const qe=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let B=null;class de{constructor(){B||(B=URL.createObjectURL(new Blob([qe],{type:"application/javascript"}))),this.worker=new Worker(B)}}de.revokeObjectURL=function(){B&&(URL.revokeObjectURL(B),B=null)};let te=0,j;class et{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new N;t.addEventListener("message",a=>{t.terminate(),N.revokeObjectURL(),e(a.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,t){return this._run("loadImageBitmap",[e,t?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){j===void 0&&(j=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<j&&(this._createdWorkers++,e=new de().worker,e.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){this._resolveHash[e.uuid]&&(e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),delete this._resolveHash[e.uuid])}async _run(e,t){await this._initWorkers();const a=new Promise((n,r)=>{this._queue.push({id:e,arguments:t,resolve:n,reject:r})});return this._next(),a}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const t=this._queue.pop(),a=t.id;this._resolveHash[te]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:te++,id:a})}reset(){this._workerPool.forEach(e=>e.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:e})=>{e?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const se=new et,tt=[".jpeg",".jpg",".png",".webp",".avif"],st=["image/jpeg","image/png","image/webp","image/avif"];async function at(s,e){const t=await A.get().fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const a=await t.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(a,{premultiplyAlpha:"none"}):createImageBitmap(a)}const pe={name:"loadTextures",id:"texture",extension:{type:g.LoadParser,priority:E.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return C(s,st)||I(s,tt)},async load(s,e,t){let a=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await se.isImageBitmapSupported()?a=await se.loadImageBitmap(s,e):a=await at(s,e):a=await new Promise((r,i)=>{a=A.get().createImage(),a.crossOrigin=this.config.crossOrigin,a.src=s,a.complete?r(a):(a.onload=()=>{r(a)},a.onerror=i)});const n=new oe({resource:a,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||K(s),...e.data});return Q(n,t,s)},unload(s){s.destroy(!0)}},nt=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let U,V;function rt(s,e,t){t===void 0&&!e.startsWith("data:")?s.crossOrigin=ot(e):t!==!1&&(s.crossOrigin=typeof t=="string"?t:"anonymous")}function it(s){return new Promise((e,t)=>{s.addEventListener("canplaythrough",a),s.addEventListener("error",n),s.load();function a(){r(),e()}function n(i){r(),t(i)}function r(){s.removeEventListener("canplaythrough",a),s.removeEventListener("error",n)}})}function ot(s,e=globalThis.location){if(s.startsWith("data:"))return"";e||(e=globalThis.location);const t=new URL(s,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function ct(){const s=[],e=[];for(const t of nt){const a=R.MIME_TYPES[t.substring(1)]||`video/${t.substring(1)}`;D(a)&&(s.push(t),e.includes(a)||e.push(a))}return{validVideoExtensions:s,validVideoMime:e}}const lt={name:"loadVideo",id:"video",extension:{type:g.LoadParser,name:"loadVideo"},test(s){if(!U||!V){const{validVideoExtensions:a,validVideoMime:n}=ct();U=a,V=n}const e=C(s,V),t=I(s,U);return e||t},async load(s,e,t){const a={...R.defaultOptions,resolution:e.data?.resolution||K(s),alphaMode:e.data?.alphaMode||await me(),...e.data},n=document.createElement("video"),r={preload:a.autoLoad!==!1?"auto":void 0,"webkit-playsinline":a.playsinline!==!1?"":void 0,playsinline:a.playsinline!==!1?"":void 0,muted:a.muted===!0?"":void 0,loop:a.loop===!0?"":void 0,autoplay:a.autoPlay!==!1?"":void 0};Object.keys(r).forEach(d=>{const p=r[d];p!==void 0&&n.setAttribute(d,p)}),a.muted===!0&&(n.muted=!0),rt(n,s,a.crossorigin);const i=document.createElement("source");let o;if(a.mime)o=a.mime;else if(s.startsWith("data:"))o=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const d=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();o=R.MIME_TYPES[d]||`video/${d}`}return i.src=s,o&&(i.type=o),new Promise((d,p)=>{a.preload&&!a.autoPlay&&n.load(),n.addEventListener("canplay",h),n.addEventListener("error",c),i.addEventListener("error",c),n.appendChild(i);async function h(){const f=new R({...a,resource:n});l(),e.data.preload&&await it(n),d(Q(f,t,s))}function c(f){l(),p(f)}function l(){n.removeEventListener("canplay",h),n.removeEventListener("error",c),i.removeEventListener("error",c)}})},unload(s){s.destroy(!0)}},he={extension:{type:g.ResolveParser,name:"resolveTexture"},test:pe.test,parse:s=>({resolution:parseFloat(W.RETINA_PREFIX.exec(s)?.[1]??"1"),format:s.split(".").pop(),src:s})},dt={extension:{type:g.ResolveParser,priority:-2,name:"resolveJson"},test:s=>W.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:he.parse};class pt{constructor(){this._detections=[],this._initialized=!1,this.resolver=new W,this.loader=new ze,this.cache=y,this._backgroundLoader=new _e(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){w("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let r=e.manifest;typeof r=="string"&&(r=await this.load(r)),this.resolver.addManifest(r)}const t=e.texturePreference?.resolution??1,a=typeof t=="number"?[t]:t,n=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:a}}),e.preferences&&this.setPreferences(e.preferences),e.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...e.loadOptions})}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();const a=ie(e),n=k(e).map(o=>{if(typeof o!="string"){const d=this.resolver.getAlias(o);return d.some(p=>!this.resolver.hasKey(p))&&this.add(o),Array.isArray(d)?d[0]:d}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),r=this.resolver.resolve(n),i=await this._mapLoadToResolve(r,t);return a?i[n[0]]:i}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let a=!1;typeof e=="string"&&(a=!0,e=[e]);const n=this.resolver.resolveBundle(e),r={},i=Object.keys(n);let o=0;const d=[],p=()=>{t?.(d.reduce((c,l)=>c+l,0)/o)},h=i.map((c,l)=>{const f=n[c],u=Object.values(f),v=[...new Set(u.flat())].reduce((b,T)=>b+(T.progressSize||1),0);return d.push(0),o+=v,this._mapLoadToResolve(f,b=>{d[l]=b*v,p()}).then(b=>{r[c]=b})});return await Promise.all(h),a?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(a=>{this._backgroundLoader.add(Object.values(a))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return y.get(e);const t={};for(let a=0;a<e.length;a++)t[a]=y.get(e[a]);return t}async _mapLoadToResolve(e,t){const a=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const n=await this.loader.load(a,t);this._backgroundLoader.active=!0;const r={};return a.forEach(i=>{const o=n[i.src],d=[i.src];i.alias&&d.push(...i.alias),d.forEach(p=>{r[p]=o}),y.set(d,o)}),r}async unload(e){this._initialized||await this.init();const t=k(e).map(n=>typeof n!="string"?n.src:n),a=this.resolver.resolve(t);await this._unloadFromResolved(a)}async unloadBundle(e){this._initialized||await this.init(),e=k(e);const t=this.resolver.resolveBundle(e),a=Object.keys(t).map(n=>this._unloadFromResolved(t[n]));await Promise.all(a)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(a=>{y.remove(a.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const a of e.detections)e.skipDetections||await a.test()?t=await a.add(t):e.skipDetections||(t=await a.remove(t));return t=t.filter((a,n)=>t.indexOf(a)===n),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(a=>a in e).forEach(a=>{t.config[a]=e[a]})})}}const P=new pt;M.handleByList(g.LoadParser,P.loader.parsers).handleByList(g.ResolveParser,P.resolver.parsers).handleByList(g.CacheParser,P.cache.parsers).handleByList(g.DetectionParser,P.detections);M.add(Be,Ce,Ee,Me,Le,Pe,ke,Fe,We,Ne,Qe,pe,lt,be,xe,he,dt);const ae={loader:g.LoadParser,resolver:g.ResolveParser,cache:g.CacheParser,detection:g.DetectionParser};M.handle(g.Asset,s=>{const e=s.ref;Object.entries(ae).filter(([t])=>!!e[t]).forEach(([t,a])=>M.add(Object.assign(e[t],{extension:e[t].extension??a})))},s=>{const e=s.ref;Object.keys(ae).filter(t=>!!e[t]).forEach(t=>M.remove(e[t]))});class z extends H{constructor(e,t,a,n){super({...e,kind:"list"},t,a,n)}addChild(e){const t=e instanceof H?e.toConfig():e;return super.addChild(t)}}class G extends H{constructor(e,t,a,n){super({...e,kind:"text"},t,a,n)}}const yt={title:"Box/ProductCatalog",argTypes:{cardWidth:{control:{type:"range",min:150,max:300,step:10}},cardHeight:{control:{type:"range",min:200,max:400,step:10}},gap:{control:{type:"range",min:0,max:30,step:2}}},args:{cardWidth:200,cardHeight:280,gap:16}},ht=[{id:"prod-1",name:"Widget Pro",price:"$29.99"},{id:"prod-2",name:"Gadget X",price:"$49.99"},{id:"prod-3",name:"Super Tool",price:"$19.99"},{id:"prod-4",name:"Mega Device",price:"$99.99"},{id:"prod-5",name:"Mini Helper",price:"$9.99"},{id:"prod-6",name:"Power Unit",price:"$59.99"}],L={cardBg:{r:.15,g:.15,b:.2},titleBarBg:{r:.2,g:.25,b:.35},contentBg:{r:.12,g:.12,b:.15},buttonBg:{r:.2,g:.5,b:.3},accent:{r:.4,g:.6,b:.9}};function ne(s,e){const t=new X,a=s/2;return t.circle(a,a,a),t.fill(e),t}function ft(s,e){const t=new X;return t.moveTo(0,0),t.lineTo(s,s),t.moveTo(s,0),t.lineTo(0,s),t.stroke({width:2,color:e}),t}function gt(s,e,t,a,n){const r=new z({id:`card-${s.id}`,xDef:{size:t,align:"start",sizeMode:"px"},yDef:{size:a,align:"start",sizeMode:"px"},direction:"vertical",gap:0,style:{fill:{color:L.cardBg,alpha:1},stroke:{color:L.accent,alpha:.3,width:1},borderRadius:8}},e),i=new z({id:`titlebar-${s.id}`,xDef:{size:t,align:"start",sizeMode:"px"},yDef:{size:36,align:"start",sizeMode:"px"},direction:"horizontal",gap:6,padding:{top:6,right:8,bottom:6,left:8},style:{fill:{color:L.titleBarBg,alpha:1},borderRadius:8}},e),o=new O({id:`blue-pip-${s.id}`,xDef:{size:8,align:"center",sizeMode:"px"},yDef:{align:"center",sizeMode:"fill"}},e);o.setContent(ne(8,6724044));const d=new O({id:`green-pip-${s.id}`,xDef:{size:8,align:"center",sizeMode:"px"},yDef:{align:"center",sizeMode:"fill"}},e);d.setContent(ne(8,10079334));const p=new G({id:`title-${s.id}`,text:s.name,xDef:{size:0,align:"center",sizeMode:"fill"},yDef:{size:24,align:"center",sizeMode:"px"},textStyle:{fontSize:14,fill:16777215,fontWeight:"bold"}},e),h=new O({id:`close-${s.id}`,xDef:{size:20,align:"center",sizeMode:"px"},yDef:{align:"center",sizeMode:"fill"},style:{fill:{color:{r:.5,g:.2,b:.2},alpha:.5}}},e);h.setContent(ft(20,13395558)),i.addChild(o),i.addChild(d),i.addChild(p),i.addChild(h);const c=new z({id:`content-${s.id}`,xDef:{size:t,align:"center",sizeMode:"px"},yDef:{size:a-36,align:"start",sizeMode:"px"},direction:"vertical",gap:12,padding:Z(12),style:{fill:{color:L.contentBg,alpha:1}}},e),l=new O({id:`image-${s.id}`,xDef:{size:t-24,align:"center",sizeMode:"px"},yDef:{size:120,align:"center",sizeMode:"px"},style:{fill:{color:{r:.2,g:.2,b:.25},alpha:1},borderRadius:4}},e),f=new ye(n);f.width=t-40,f.height=100,l.setContent(f);const u=new G({id:`price-${s.id}`,text:s.price,xDef:{size:0,align:"center",sizeMode:"hug"},yDef:{size:0,align:"center",sizeMode:"hug"},padding:{top:4,right:8,bottom:4,left:8},textStyle:{fontSize:20,fill:6750054,fontWeight:"bold"}},e),m=new G({id:`buy-${s.id}`,text:"Buy Now",xDef:{size:t-48,align:"center",sizeMode:"px"},yDef:{size:32,align:"center",sizeMode:"px"},padding:Z(6),style:{fill:{color:L.buttonBg,alpha:1},borderRadius:4},textStyle:{fontSize:14,fill:16777215,fontWeight:"bold"}},e);return c.addChild(l),c.addChild(u),c.addChild(m),r.addChild(i),r.addChild(c),r}const F={render:s=>{const e=document.createElement("div");e.style.width="100%",e.style.height="700px",e.style.position="relative";const t=new Ae;return t.init({width:800,height:700,backgroundColor:657938,antialias:!0}).then(async()=>{e.appendChild(t.canvas);let a;try{a=await P.load("/placeholder-art.png")}catch{const r=new X;r.rect(0,0,160,100),r.fill(3359829),a=t.renderer.generateTexture(r)}const n=new z({id:"grid-container",x:40,y:40,xDef:{size:720,align:"start",sizeMode:"hug"},yDef:{size:620,align:"start",sizeMode:"hug"},direction:"vertical",gap:s.gap},t);for(let r=0;r<2;r++){const i=new z({id:`row-${r}`,xDef:{size:0,align:"start",sizeMode:"hug"},yDef:{size:s.cardHeight,align:"start",sizeMode:"px"},direction:"horizontal",gap:s.gap},t);for(let o=0;o<3;o++){const d=r*3+o,p=ht[d],h=gt(p,t,s.cardWidth,s.cardHeight,a);i.addChild(h)}n.addChild(i)}t.stage.addChild(n.container),n.markDirty()}),e}};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:`{
  render: args => {
    const wrapper = document.createElement('div');
    wrapper.style.width = '100%';
    wrapper.style.height = '700px';
    wrapper.style.position = 'relative';
    const app = new Application();
    app.init({
      width: 800,
      height: 700,
      backgroundColor: 0x0a0a12,
      antialias: true
    }).then(async () => {
      wrapper.appendChild(app.canvas);

      // Load placeholder texture
      let texture: Texture;
      try {
        texture = await Assets.load('/placeholder-art.png');
      } catch {
        // Fallback to generated texture
        const g = new Graphics();
        g.rect(0, 0, 160, 100);
        g.fill(0x334455);
        texture = app.renderer.generateTexture(g);
      }

      // Create grid container (3 columns x 2 rows)
      const gridContainer = new BoxListStore({
        id: 'grid-container',
        x: 40,
        y: 40,
        xDef: {
          size: 720,
          align: 'start',
          sizeMode: 'hug'
        },
        yDef: {
          size: 620,
          align: 'start',
          sizeMode: 'hug'
        },
        direction: 'vertical',
        gap: args.gap
      }, app);

      // Create rows
      for (let row = 0; row < 2; row++) {
        const rowContainer = new BoxListStore({
          id: \`row-\${row}\`,
          xDef: {
            size: 0,
            align: 'start',
            sizeMode: 'hug'
          },
          yDef: {
            size: args.cardHeight,
            align: 'start',
            sizeMode: 'px'
          },
          direction: 'horizontal',
          gap: args.gap
        }, app);
        for (let col = 0; col < 3; col++) {
          const productIndex = row * 3 + col;
          const product = products[productIndex];
          const card = createProductCard(product, app, args.cardWidth, args.cardHeight, texture);
          rowContainer.addChild(card);
        }
        gridContainer.addChild(rowContainer);
      }
      app.stage.addChild(gridContainer.container);
      gridContainer.markDirty();
    });
    return wrapper;
  }
}`,...F.parameters?.docs?.source}}};const vt=["Catalog"];export{F as Catalog,vt as __namedExportsOrder,yt as default};
